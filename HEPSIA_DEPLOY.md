# Инструкция по развертыванию на Hepsia Shared Hosting

## Шаг 1: Создание базы данных (уже выполнено ✅)

База данных уже создана. Запишите следующие данные:

- **Имя базы данных**: `_________________`
- **Имя пользователя БД**: `_________________`
- **Пароль БД**: `_________________`
- **Хост БД**: обычно `localhost` (или уточните в панели Hepsia)

## Шаг 2: Загрузка структуры базы данных через phpMyAdmin

1. Войдите в **phpMyAdmin** через панель управления Hepsia
2. Выберите вашу базу данных в левом меню
3. Перейдите на вкладку **"SQL"** (вверху)
4. Откройте файл `database/schema.sql` из проекта на вашем компьютере
5. Скопируйте **весь** содержимое файла `schema.sql`
6. Вставьте в текстовое поле в phpMyAdmin
7. Нажмите **"Вперед"** (Execute)

**Альтернативный способ (если есть возможность импорта):**

- В phpMyAdmin выберите вашу БД
- Перейдите на вкладку **"Импорт"**
- Выберите файл `database/schema.sql`
- Нажмите **"Вперед"**

После выполнения вы должны увидеть 4 таблицы:

- `users`
- `categories`
- `operations`
- `monthly_budgets`

## Шаг 3: Загрузка файлов Backend через файловый менеджер

### 3.1. Определите путь для API

Обычно на Hepsia это одна из следующих структур:

- `public_html/api/` - если API будет доступен по адресу `api.phi.nagiyev.com/api/`
- `public_html/backend/` - если API будет доступен по адресу `api.phi.nagiyev.com/backend/`
- Или отдельный поддомен `api.phi.nagiyev.com` → тогда в корне этого поддомена

**Уточните у хостинга или в документации Hepsia, какой путь использовать для API.**

### 3.2. Загрузите файлы Backend

Загрузите **все файлы и папки** из папки `backend/` проекта:

```
backend/
├── api/                    ← загрузить всю папку
│   ├── analytics.php
│   ├── auth.php
│   ├── budget.php
│   ├── categories.php
│   ├── export.php
│   ├── me.php
│   └── operations.php
├── config/                 ← загрузить всю папку
│   ├── auth.php
│   └── database.php
├── models/                 ← загрузить всю папку
│   ├── Category.php
│   ├── MonthlyBudget.php
│   ├── Operation.php
│   └── User.php
├── utils/                  ← загрузить всю папку
│   ├── auth.php
│   ├── database.php
│   ├── middleware.php
│   ├── migrate.php
│   ├── response.php
│   └── validation.php
├── .htaccess               ← ОБЯЗАТЕЛЬНО загрузить
├── index.php               ← ОБЯЗАТЕЛЬНО загрузить (главный файл)
└── error.log               ← можно не загружать (создастся автоматически)
```

**Важно:**

- Загружайте файлы с сохранением структуры папок
- Файл `.htaccess` обязателен для работы роутинга
- Файл `index.php` - это точка входа API

### 3.3. Создайте файл `.env`

В корне папки backend (там же, где `index.php`) создайте файл `.env` со следующим содержимым:

```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=ваше_имя_базы_данных
DB_USER=ваш_пользователь_бд
DB_PASSWORD=ваш_пароль_бд

JWT_SECRET=сгенерируйте_случайную_длинную_строку_минимум_32_символа
APP_ENV=production
APP_URL=https://api.phi.nagiyev.com/api
```

**Как создать `.env` файл:**

1. В файловом менеджере Hepsia создайте новый файл
2. Назовите его `.env` (с точкой в начале!)
3. Вставьте содержимое выше, заменив значения на ваши
4. Сохраните

**Генерация JWT_SECRET:**
Можно использовать онлайн-генератор случайных строк или выполнить в терминале:

```bash
openssl rand -base64 32
```

## Шаг 4: Настройка прав доступа

Убедитесь, что файлы имеют правильные права:

- Файлы: `644` или `644`
- Папки: `755`
- Файл `.env`: `600` (только владелец может читать/писать)

Обычно на shared хостинге права устанавливаются автоматически, но проверьте.

## Шаг 5: Проверка работы API

### 5.1. Проверка через браузер

Откройте в браузере:

```
https://api.phi.nagiyev.com/api/
```

Должна вернуться ошибка 404 или JSON с сообщением об ошибке (это нормально, значит API работает).

### 5.2. Проверка через тестовый скрипт

Создайте файл `test.php` в корне backend с содержимым:

```php
<?php
require_once __DIR__ . '/config/database.php';
$config = require __DIR__ . '/config/database.php';

try {
    $pdo = new PDO(
        "mysql:host={$config['host']};port={$config['port']};dbname={$config['dbname']};charset=utf8mb4",
        $config['username'],
        $config['password'],
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        ]
    );
    echo "✅ Подключение к БД успешно!";
} catch (PDOException $e) {
    echo "❌ Ошибка подключения: " . $e->getMessage();
}
```

## Шаг 6: Настройка CORS (если нужно)

Если frontend будет на другом домене, откройте файл `backend/index.php` и измените строку 3:

```php
header("Access-Control-Allow-Origin: https://phi.nagiyev.com");
```

Замените на ваш домен frontend:

```php
header("Access-Control-Allow-Origin: https://phi.nagiyev.com");
```

## Шаг 7: Загрузка Frontend (если нужно)

Если вы также развертываете frontend на Hepsia:

1. Соберите frontend: `npm run build` (в папке `frontend/`)
2. Загрузите **все содержимое** папки `frontend/dist/` в `public_html/` (или в нужную папку для frontend)
3. Убедитесь, что файл `index.html` находится в корне

## Возможные проблемы и решения

### Проблема: "404 Not Found" при обращении к API

**Решение:**

- Проверьте, что файл `.htaccess` загружен и находится в корне backend
- Убедитесь, что на хостинге включен модуль `mod_rewrite` (обычно включен на Hepsia)
- Проверьте путь в URL - должен быть `/api/...`

### Проблема: "500 Internal Server Error"

**Решение:**

- Проверьте файл `error.log` в папке backend
- Убедитесь, что файл `.env` создан и содержит правильные данные
- Проверьте права доступа к файлам

### Проблема: "Connection refused" или ошибка подключения к БД

**Решение:**

- Проверьте данные в `.env` (имя БД, пользователь, пароль)
- Убедитесь, что хост БД правильный
- Проверьте в панели Hepsia точный хост для MySQL

### Проблема: "Table doesn't exist"

**Решение:**

- Убедитесь, что вы выполнили SQL из `database/schema.sql` в правильной базе данных
- Проверьте в phpMyAdmin, что таблицы созданы

## Контрольный список

- [ ] База данных создана
- [ ] SQL схема загружена через phpMyAdmin (4 таблицы созданы)
- [ ] Все файлы backend загружены с сохранением структуры
- [ ] Файл `.htaccess` загружен
- [ ] Файл `.env` создан с правильными данными БД
- [ ] JWT_SECRET установлен (случайная строка)
- [ ] Тестовое подключение к БД работает
- [ ] CORS настроен для вашего frontend домена
- [ ] Frontend загружен (если нужно)

## Полезные ссылки

- Документация Hepsia: [уточните у хостинга]
- phpMyAdmin: доступ через панель управления Hepsia
- Файловый менеджер: доступ через панель управления Hepsia

---

**После выполнения всех шагов ваш API должен быть доступен по адресу:**

```
https://api.phi.nagiyev.com/api/
```

**Примеры запросов:**

- Регистрация: `POST https://api.phi.nagiyev.com/api/auth/register`
- Вход: `POST https://api.phi.nagiyev.com/api/auth/login`
